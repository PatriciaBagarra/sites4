!function(a,b){"undefined"!=typeof exports?b(exports):"function"==typeof require&&"function"==typeof require.specified&&require.specified("CerosSDK")?define(["exports"],b):b(a)}(this,function(a){var b=function(){this._doneCallbacks=[],this._failCallbacks=[],this._alwaysCallbacks=[],this.STATE={PENDING:"pending",RESOLVED:"resolved",REJECTED:"rejected"},this._state=this.STATE.PENDING,this._arguments=null};b.prototype={executeCallbacks:function(a,b){this._arguments=Array.prototype.slice.call(b);var c=0;for(c=0;c<a.length;c++)a[c].apply(null,this._arguments)},done:function(a){return this._state==this.STATE.RESOLVED?(a.apply(null,this._arguments),this):(this._doneCallbacks.push(a),this)},fail:function(a){return this._state==this.STATE.REJECTED?(a.apply(null,this._arguments),this):(this._failCallbacks.push(a),this)},always:function(a){return this._state!=this.STATE.PENDING?(a.apply(null,this._arguments),this):(this._alwaysCallbacks.push(a),this)},resolve:function(){return this._state=this.STATE.RESOLVED,this.executeCallbacks(this._doneCallbacks,arguments),this.executeCallbacks(this._alwaysCallbacks,arguments),this},reject:function(){return this._state=this.STATE.REJECTED,this.executeCallbacks(this._failCallbacks,arguments),this.executeCallbacks(this._alwaysCallbacks,arguments),this},state:function(){return this._state}};var c={VERSION:"5.4.0",NAMESPACE:"ceros.sdk.player:",EVENTS:{PAGE_CHANGED:"page.changed",PAGE_CHANGING:"page.changing",CLICKED:"component.clicked",SHOWN:"layer.shown",HIDDEN:"layer.hidden",FOLDER_SHOWN:"folder.shown",FOLDER_HIDDEN:"folder.hidden",SOCIAL_SHARE:"social.share",ANIMATION_STARTED:"animation.started",ANIMATION_ENDED:"animation.ended",VIDEO_PLAYED:"video.played",CONTEXT_VALUE_RESPONSE:"context.value.response",USER_CONSENT:"user.consent",COMPONENT_CLICKED:"component.clicked",LAYER_SHOWN:"layer.shown",LAYER_HIDDEN:"layer.hidden"},PAGESTATE:{ENABLED:"enabled",DISABLED:"disabled"},SHARING_TYPES:{FACEBOOK:"facebook",TWITTER:"twitter",PINTEREST:"pinterest",EMAIL:"email"},CONTEXT:{APP_SLUG:"appSlug",PROJECT_ID:"issue.projectId",ID:"issue.id",LAST_PUBLISHED_DATE:"issue.lastPublishedDate",PREVIEW_MODE:"previewMode",FIRST_PUBLISHED_DATE:"issue.firstPublishedDate",CREATION_DATE:"issue.creationDate",LAST_MODIFIED_DATE:"issue.lastModifiedDate"},CONSENT:{UNKNOWN:"Unknown",CONSENTED:"Consented",DECLINED:"Declined"}};c.INTERNAL_SHARE_TYPES={"share-facebook":c.SHARING_TYPES.FACEBOOK,"share-twitter":c.SHARING_TYPES.TWITTER,"share-pinterest":c.SHARING_TYPES.PINTEREST,"share-email":c.SHARING_TYPES.EMAIL};var d=0,e=1,f=2,g=3,h=4,i=function(){for(var a=document.getElementsByTagName("script"),b=0,c=a.length;c>b;b++){var e=a[b],f=e.getAttribute("src");if(f&&-1!==f.indexOf("embedded-player-sdk")){var g=e.getAttribute("data-debug");if(g)return j(g)}}return d},j=function(a){var b=d;if("string"==typeof a)switch(a.toLowerCase()){case"debug":b=h;break;case"info":b=g;break;case"warn":b=f;break;case"error":b=e;break;default:b=d}return b},k={log:window.console&&"function"==typeof console.log?function(){console.log.apply(console,arguments)}:function(){}};k.info=window.console&&"function"==typeof console.info?function(){console.info.apply(console,arguments)}:k.log,k.warn=window.console&&"function"==typeof console.warn?function(){console.warn.apply(console,arguments)}:k.log,k.error=window.console&&"function"==typeof console.error?function(){console.error.apply(console,arguments)}:k.log;var l={LOG_NONE:d,LOG_ERROR:e,LOG_WARN:f,LOG_INFO:g,LOG_DEBUG:h};l.log=function(a,b){if(!(l.logLevel<b))switch(a="Ceros Player SDK :: "+a,b){case l.LOG_DEBUG:k.log(a);break;case l.LOG_INFO:k.info(a);break;case l.LOG_WARN:k.warn(a);break;case l.LOG_ERROR:k.error(a)}},l.setLogLevel=function(a){l.logLevel=j(a)},l.logLevel=i();var m=function(a,b){b=JSON.stringify(b),l.log("Posting message to an iframe: "+b,l.LOG_DEBUG),a.postMessage(b,"*")},n=function(a){this.frameContentWindow=a};n.prototype={send:function(a,b){var d={name:c.NAMESPACE+a,version:c.VERSION,params:b};m(this.frameContentWindow,d)}};var o=function(a){this.globalEventHandlers={},this.experienceSpecificEventHandlers={},this.objectSpecificEventHandlers={},this.isEmbedded=a,this.cerosWindows=[],this.needToInvalidateCerosIframeCache=!0};o.prototype={registerGlobalHandler:function(a,b){return"function"!=typeof b?void l.log("Attempt to register a non-function event handler.",l.LOG_WARN):(this.globalEventHandlers.hasOwnProperty(a)||(this.globalEventHandlers[a]=[]),void this.globalEventHandlers[a].push(b))},registerExperienceSpecificHandler:function(a,b,c){return"function"!=typeof c?void l.log("Attempt to register a non-function event handler.",l.LOG_WARN):(this.experienceSpecificEventHandlers[a]||(this.experienceSpecificEventHandlers[a]={}),this.experienceSpecificEventHandlers[a].hasOwnProperty(b)||(this.experienceSpecificEventHandlers[a][b]=[]),void this.experienceSpecificEventHandlers[a][b].push(c))},registerObjectSpecificHandler:function(a,b,c,d){return"function"!=typeof d?void l.log("Attempt to register a non-function event handler.",l.LOG_WARN):(this.objectSpecificEventHandlers.hasOwnProperty(a)||(this.objectSpecificEventHandlers[a]={}),this.objectSpecificEventHandlers[a].hasOwnProperty(c)||(this.objectSpecificEventHandlers[a][c]={}),this.objectSpecificEventHandlers[a][c].hasOwnProperty(b)||(this.objectSpecificEventHandlers[a][c][b]=[]),void this.objectSpecificEventHandlers[a][c][b].push(d))},handleEvent:function(a,b,c){var d=c.experienceId;if(this.globalEventHandlers.hasOwnProperty(b))for(var e=0;e<this.globalEventHandlers[b].length;e++)this.globalEventHandlers[b][e](c,a);if(this.experienceSpecificEventHandlers[d]&&this.experienceSpecificEventHandlers[d].hasOwnProperty(b))for(var f=0;f<this.experienceSpecificEventHandlers[d][b].length;f++)this.experienceSpecificEventHandlers[d][b][f](c,a);if(this.objectSpecificEventHandlers[d]&&this.objectSpecificEventHandlers[d].hasOwnProperty(b)){if(c.layerId){var g=c.layerId;if(this.objectSpecificEventHandlers[d][b][g])for(var h=this.objectSpecificEventHandlers[d][b][g],i=0;i<h.length;i++)h[i](c)}if(c.componentId){var j=c.componentId;if(this.objectSpecificEventHandlers[d][b][j])for(var k=this.objectSpecificEventHandlers[d][b][j],l=0;l<k.length;l++)k[l](c)}}},stripNamespace:function(a){var b=new RegExp("^"+c.NAMESPACE);return a.replace(b,"")},processMessage:function(a){if(this.isEmbedded){var b=!1;this.needToInvalidateCerosIframeCache&&(this.populateListOfCerosWindows(),this.needToInvalidateCerosIframeCache=!1);for(var d=0;d<this.cerosWindows.length;d++)if(this.cerosWindows[d]===a.source){b=!0;break}if(!b)return void l.log("Received message from unknown origin: "+a.origin,l.LOG_DEBUG)}try{var e=JSON.parse(a.data);if(e.name){if(0!==e.name.indexOf(c.NAMESPACE))return void l.log("Received a message that wasn't namespaced to the Ceros SDK: "+e.name,l.LOG_DEBUG);e.name=this.stripNamespace(e.name),l.log("Received message: "+e.name,l.LOG_DEBUG),this.handleEvent(a.source,e.name,e.params)}}catch(f){l.log("Error processing message: "+f,l.LOG_DEBUG)}},populateListOfCerosWindows:function(){this.cerosWindows=[];for(var a=document.getElementsByTagName("iframe"),b=0;b<a.length;b++)for(var c=0;c<a[b].classList.length;c++)"ceros-experience"===a[b].classList[c]&&this.cerosWindows.push(a[b].contentWindow)}};var p=function(a,b){this.messenger=a,this.eventHandler=b,this.callback=null,_this=this,this.eventHandler.registerGlobalHandler("context.value.response",function(a){_this.callback&&_this.callback(a)})};p.prototype={enumerateVariables:function(){return c.CONTEXT},getValue:function(a){var b=window.cerosContext;return b?_.get(b,a):void 0},getEmbeddedValue:function(a,b){this.callback=b,this.messenger.send("sdk.context.get.value",{name:a})},on:function(a,b){a===c.EVENTS.CONTEXT_VALUE_RESPONSE&&this.eventHandler.registerGlobalHandler(a,function(a){b(a)})}};var q=function(a,b){this.eventHandler=a,this.experienceTracker=b,"loading"!==document.readyState?this.initializeAndAddMessageEventHandler():window.addEventListener("DOMContentLoaded",this.initializeAndAddMessageEventHandler.bind(this))};q.prototype={VERSION:c.VERSION,EVENTS:c.EVENTS,SHARING_TYPES:c.SHARING_TYPES,PAGESTATE:c.PAGESTATE,CONTEXT:c.CONTEXT,domain:"view.ceros.com",initializeAndAddMessageEventHandler:function(){var a=this;this.getExperienceTracker().initialize(),this.eventHandler.registerGlobalHandler("ready",function(b,c){a.getExperienceTracker().addLoadedExperience(b,c)}),window.addEventListener("message",function(b){a.eventHandler.processMessage(b)},!1)},getExperienceTracker:function(){return this.experienceTracker},setMessenger:function(a){for(var b in a.prototype)Object.prototype.hasOwnProperty.call(a.prototype,b)&&(n.prototype[b]=a.prototype[b]);n.prototype.constructor=a},setEventSpy:function(a){return a.setEventHandler(this.eventHandler),a.setNamespace(c.NAMESPACE),a.setVersion(c.VERSION),this},findExperience:function(a){return this.experienceTracker.getExperience(a)},setLogLevel:function(a){l.setLogLevel(a)},enumerateContextVariables:function(){return p.prototype.enumerateVariables()},getContextValue:function(a){return p.prototype.getValue(a)}};var r=function(a,b){this.layers=a,this.messenger=b,this.layersByTag={};for(var c=0;c<this.layers.length;c++){var d=this.layers[c],e=d.getTags();if(e&&e.length)for(var f=0;f<e.length;f++){var g=e[f];Object.prototype.hasOwnProperty.call(this.layersByTag,g)||(this.layersByTag[g]=[]),this.layersByTag[g].push(d)}}};r.prototype={show:function(){for(var a=0;a<this.layers.length;a++)this.layers[a].show()},hide:function(){for(var a=0;a<this.layers.length;a++)this.layers[a].hide()},on:function(a,b){for(var c=0;c<this.layers.length;c++)this.layers[c].on(a,b)},merge:function(a){return a.push(this),r.merge(a,this.messenger)}},r.merge=function(a,b){for(var c={},d=0;d<a.length;d++)if(a[d].layers)for(var e=0;e<a[d].layers.length;e++)c[a[d].layers[e].id]=a[d].layers[e];var f=[];for(var g in c)c.hasOwnProperty(g)&&f.push(c[g]);return new r(f,b)};var s=function(a,b){r.call(this,a,b),this.components=a,this.messenger=b,this.componentsByTag={};for(var c=0;c<this.components.length;c++){var d=this.components[c],e=d.getTags();if(e&&e.length)for(var f=0;f<e.length;f++){var g=e[f];Object.prototype.hasOwnProperty.call(this.componentsByTag,g)||(this.componentsByTag[g]=[]),this.componentsByTag[g].push(d)}}};s.prototype=Object.create(r.prototype),s.prototype.findComponentsByTag=function(a){var b=[];return Object.prototype.hasOwnProperty.call(this.componentsByTag,a)&&(b=this.componentsByTag[a]),new s(b,this.messenger)},s.prototype.click=function(){for(var a=0;a<this.components.length;a++)this.components[a].click()},s.prototype.reset=function(){for(var a=0;a<this.components.length;a++)this.components[a].reset()},s.prototype.startVideo=function(){for(var a=0;a<this.components.length;a++)this.components[a].isVideoComponent()&&this.components[a].startVideo()},s.prototype.stopVideo=function(){for(var a=0;a<this.components.length;a++)this.components[a].isVideoComponent()&&this.components[a].stopVideo()},s.prototype.setText=function(a){for(var b=0;b<this.components.length;b++)this.components[b].isTextComponent()&&this.components[b].setText(a)},s.prototype.merge=function(a){return a.push(this),s.merge(a,this.messenger)},s.merge=function(a,b){for(var c={},d=0;d<a.length;d++)if(a[d].components)for(var e=0;e<a[d].components.length;e++)c[a[d].components[e].id]=a[d].components[e];var f=[];for(var g in c)c.hasOwnProperty(g)&&f.push(c[g]);return new s(f,b)};var t={};t.findAllLayers=function(a,b){for(var c=[],d=0;d<a.length;d++)if(c.push(b.findLayerById(a[d].id)),!a[d].syncedObjectId){var e=a[d].items&&a[d].items.length>0;e&&(c=c.concat(t.findAllLayers(a[d].items,b)))}return c},t.findAllComponents=function(a,b){for(var c=[],d=0;d<a.length;d++)if(!a[d].syncedObjectId){var e=a[d].items&&a[d].items.length>0;"group"===a[d].type&&c.push(b.findLayerById(a[d].id)),e?c=c.concat(t.findAllComponents(a[d].items,b)):"folder"!==a[d].type&&c.push(b.findLayerById(a[d].id))}return c},t.findAllSyncedObjects=function(a,b){for(var c=[],d=0;d<a.length;d++)"folder"===a[d].type?c=c.concat(t.findAllSyncedObjects(a[d].items,b)):a[d].syncedObjectId&&c.push(b.findLayerById(a[d].id));return c},t.buildExperienceMaps=function(a,b){function c(a){if(a.syncedObjectId)f[a.id]=a;else if(a.items){for(var b=0;b<a.items.length;b++)c(a.items[b]);"group"===a.type&&(g[a.id]=a)}else g[a.id]=a;h[a.id]=a}for(var d,e={},f={},g={},h={},i={},j=b[0].height,k=0;k<a.length;k++){for(var l=a[k],m=0;m<l.layers.length;m++){var n=l.layers[m];c(n)}e[l.id]=l}for(var k=0;k<b.length;k++){for(var o=b[k],m=0;m<o.layers.length;m++){var p=o.layers[m];c(p)}i[o.pageSlug]=o,j!=o.height&&(d=!0)}return{syncedObjectDefinitionMap:e,syncedObjectInstanceMap:f,componentMap:g,layerMap:h,pageMap:i,variablePageHeights:d}};var u=function(a,b,c,d,e){this.id=a.id,this.type=a.type,this.tags=a.tags,this.payload=a.payload,this.items=a.items,this.messenger=b,this.eventHandler=c,this.experience=d,this.experienceId=d.experienceId,this.page=e};u.prototype={getPayload:function(){return this.payload},getTags:function(){return this.tags},getPage:function(){return this.page},isGroup:function(){return!1},isFolder:function(){return"folder"===this.type},isComponent:function(){return!1},isSyncedObject:function(){return!1},show:function(){this.messenger.send("sdk.layer.show",{layerId:this.id})},hide:function(){this.messenger.send("sdk.layer.hide",{layerId:this.id})},findAllComponents:function(){if(!this.items||0===this.items.length)return new s([],this.messenger);var a=t.findAllComponents(this.items,this.experience);return new s(a,this.messenger)},on:function(a,b){var d=this;(this.isSyncedObject()||this.isComponent())&&(a===c.EVENTS.SOCIAL_SHARE?this.eventHandler.registerObjectSpecificHandler(this.experienceId,this.id,a,function(a){var e=c.INTERNAL_SHARE_TYPES[a.shareType];b(d,e)}):(a===c.EVENTS.CLICKED||a===c.EVENTS.ANIMATION_STARTED||a===c.EVENTS.ANIMATION_ENDED)&&this.eventHandler.registerObjectSpecificHandler(this.experienceId,this.id,a,function(a){b(d)})),(a===c.EVENTS.SHOWN||a===c.EVENTS.HIDDEN)&&this.eventHandler.registerObjectSpecificHandler(this.experienceId,this.id,a,function(a){b(d)})}};var v=function(a,b,c,d,e){u.call(this,a,b,c,d,e),this.width=a.width,this.height=a.height,this.x=a.x,this.y=a.y,this.textContent=a.textContent,this.fullResolutionUrl=a.fullResolutionUrl,this.originalTextContent=null};v.prototype=Object.create(u.prototype),v.prototype.getWidth=function(){return this.width},v.prototype.getHeight=function(){return this.height},v.prototype.getX=function(){return this.x},v.prototype.getY=function(){return this.y},v.prototype.getText=function(){return this.textContent},v.prototype.getFullResolutionUrl=function(){return this.fullResolutionUrl},v.prototype.isVideoComponent=function(){return"video"===this.type},v.prototype.isImageComponent=function(){return"image"===this.type},v.prototype.isTextComponent=function(){return"text"===this.type},v.prototype.startVideo=function(){this.isVideoComponent()&&this.messenger.send("sdk.component.video.start",{componentId:this.id})},v.prototype.stopVideo=function(){this.isVideoComponent()&&this.messenger.send("sdk.component.video.stop",{componentId:this.id})},v.prototype.setText=function(a){this.isTextComponent()&&(this.messenger.send("sdk.component.text.settext",{componentId:this.id,textContent:a}),null===this.originalTextContent&&(this.originalTextContent=this.textContent),this.textContent=a)},v.prototype.setUrl=function(a,b){this.isImageComponent()&&(b=b||!1,this.messenger.send("sdk.component.image.seturl",{componentId:this.id,url:a,useNewImageSize:b}))},v.prototype.isComponent=function(){return!0},v.prototype.isGroup=function(){return"group"===this.type},v.prototype.reset=function(){this.isTextComponent()&&(null!==this.originalTextContent?this.setText(this.originalTextContent):this.setText(this.textContent)),this.isImageComponent()&&this.messenger.send("sdk.component.image.reset",{componentId:this.id})},v.prototype.click=function(){this.messenger.send("sdk.component.click",{componentId:this.id})},v.prototype.show=function(){this.messenger.send("sdk.component.show",{componentId:this.id})},v.prototype.hide=function(){this.messenger.send("sdk.component.hide",{componentId:this.id})},v.prototype.on=function(a,b){u.prototype.on.call(this,a,b);var d=this;this.isVideoComponent()&&a===c.EVENTS.VIDEO_PLAYED&&this.eventHandler.registerObjectSpecificHandler(this.experienceId,this.id,a,function(a){b(d)})};var w=function(a,b){r.call(this,a,b),this.syncedObjects=a,this.messenger=b};w.prototype=Object.create(r.prototype),w.prototype.findAllLayers=function(){for(var a=[],b=0;b<this.syncedObjects.length;b++)a.push(this.syncedObjects[b].findAllLayers());return r.merge(a,this.messenger)},w.prototype.click=function(){for(var a=0;a<this.syncedObjects.length;a++)this.syncedObjects[a].click()};var x=function(a,b,c){this.pageNumber=a.pageNumber,this.pageSlug=a.pageSlug,this.tags=a.tags,this.payload=a.payload,this.layers=a.layers,this.enabled=!0,this.messenger=b,this.experience=c,this.width=a.width,this.height=a.height};x.prototype={getPayload:function(){return this.payload},getTags:function(){return this.tags},getWidth:function(){return this.width},getHeight:function(){return this.height},getPageNumber:function(){return this.pageNumber},disable:function(){this.messenger.send("sdk.page.disable",{pageNum:this.pageNumber}),this.enabled=!1},enable:function(){this.messenger.send("sdk.page.enable",{pageNum:this.pageNumber}),this.enabled=!0},findAllComponents:function(){var a=t.findAllComponents(this.layers,this.experience);return new s(a,this.messenger)},findAllLayers:function(){var a=t.findAllLayers(this.layers,this.experience);return new r(a,this.messenger)},findAllSyncedObjects:function(){var a=t.findAllSyncedObjects(this.layers,this.experience);return new w(a,this.messenger,this)},startAnimations:function(){this.messenger.send("sdk.page.animations.start",{pageSlug:this.pageSlug})},pauseAnimations:function(){this.messenger.send("sdk.page.animations.pause",{pageSlug:this.pageSlug})},getPageState:function(){return this.enabled?c.PAGESTATE.ENABLED:c.PAGESTATE.DISABLED}};var y=function(a,b){this.pages=a,this.messenger=b};y.prototype={disable:function(){for(var a=0;a<this.pages.length;a++)this.pages[a].disable()},enable:function(){for(var a=0;a<this.pages.length;a++)this.pages[a].enable()},findAllComponents:function(){for(var a=[],b=0;b<this.pages.length;b++)a=s.merge([this.pages[b].findAllComponents(),a],this.messenger);return a}};var z=function(a,b,c,d,e,f){u.call(this,a,c,d,e,f),this.layers=b.layers};z.prototype=Object.create(u.prototype),z.prototype.findAllLayers=function(){var a=t.findAllLayers(this.layers,this.experience);return new r(a,this.messenger)},z.prototype.click=function(){this.messenger.send("sdk.component.click",{componentId:this.id})},z.prototype.isSyncedObject=function(){return!0},z.prototype.on=function(a,b){u.prototype.on.call(this,a,b);var d=this;a===c.EVENTS.CLICKED&&this.eventHandler.registerObjectSpecificHandler(this.experience.experienceId,this.id,a,function(a){b(d)})};var A={buildLayerType:function(a,b,c,d,e){if(a.syncedObjectId&&d.syncedObjectInstanceMap[a.id]){var f=d.syncedObjectInstanceMap[a.id];if(d.syncedObjectDefinitionMap[f.syncedObjectId]){var g=d.syncedObjectDefinitionMap[f.syncedObjectId];return new z(f,g,b,c,d,e)}throw"Unable to create synced object with instance id"+a.id+" and smartgroup Id"+a.syncedObjectId}return"group"===a.type?new v(a,b,c,d,e):"folder"===a.type?new u(a,b,c,d,e):new v(a,b,c,d,e)}},B=function(a,b,d,e,f,g){this.experienceId=a,this.window=b.source,this.experienceTitle=b.experienceTitle,this.allPageData=b.allPageData,this.allSyncedObjectData=b.allSyncedObjectData,this.documentVersion=b.documentVersion,this.currentPageNumber=b.currentPageNumber,this.tags=b.tags,this.userToken=b.userToken,this.messenger=d,this.eventHandler=e,this.experienceTracker=f,this.variablePageHeights=!1,this.containerId=g,this.userConsentCallback=null;var h=this;this.eventHandler.registerExperienceSpecificHandler(this.experienceId,"page.changed",function(a){h.experienceTracker.cerosExperienceObjects[a.experienceId]&&(h.experienceTracker.cerosExperienceObjects[a.experienceId].currentPageNumber=a.pageNum)}),this.eventHandler.registerExperienceSpecificHandler(this.experienceId,c.EVENTS.USER_CONSENT,function(a){if(h.userConsentCallback){var b=a.consent;h.userConsentCallback(null===b?c.CONSENT.UNKNOWN:b?c.CONSENT.CONSENTED:c.CONSENT.DECLINED)}});var i=t.buildExperienceMaps(this.allSyncedObjectData,this.allPageData);this.syncedObjectDefinitionMap=i.syncedObjectDefinitionMap,this.syncedObjectInstanceMap=i.syncedObjectInstanceMap,this.componentMap=i.componentMap,this.layerMap=i.layerMap,this.pageMap=i.pageMap,this.variablePageHeights=i.variablePageHeights};B.prototype={getTitle:function(){return this.experienceTitle},getCurrentPage:function(){return new x(this.allPageData[this.currentPageNumber-1],this.messenger,this)},getCurrentUserId:function(){return this.userToken},getAllPages:function(){for(var a=Object.keys(this.pageMap),b=[],c=0;c<a.length;c++)b.push(this.findPageById(a[c]));return new y(b,this.messenger)},findPageById:function(a){return this.pageMap[a]?new x(this.pageMap[a],this.messenger,this):null},findPagesByTag:function(a){var b=[];if(this.tags[a])for(var c=0;c<this.tags[a].pages.length;c++)for(var d=0;d<this.allPageData.length;d++)this.allPageData[d].pageSlug===this.tags[a].pages[c]&&b.push(new x(this.allPageData[d],this.messenger,this));return new y(b,this.messenger)},goToPage:function(a){this.messenger.send("sdk.experience.page.goto",{pageNum:a})},goToNextPage:function(){this.messenger.send("sdk.experience.page.next",{})},goToPreviousPage:function(){this.messenger.send("sdk.experience.page.previous",{})},findAllSyncedObjects:function(){for(var a=[],b=0;b<this.allPageData.length;b++){var c=this.allPageData[b];a=a.concat(t.findAllSyncedObjects(c.layers,this))}return new w(a,this.messenger)},findSyncedObjectById:function(a){if(this.syncedObjectInstanceMap[a]){var b=this.syncedObjectInstanceMap[a],c=this.findPageById(b.pageSlug);return A.buildLayerType(b,this.messenger,this.eventHandler,this,c)}return null},findSyncedObjectsByTag:function(a){var b=[];if(this.tags[a])for(var c=0;c<this.tags[a].syncedObjects.length;c++)b.push(this.findSyncedObjectById(this.tags[a].syncedObjects[c]));return new w(b,this.messenger)},findSyncedObjectsWithAnyTags:function(a){var b={};if(a)for(var c=0;c<a.length;c++)for(var d=this.findSyncedObjectsByTag(a[c]),e=0;e<d.syncedObjects.length;e++){var f=d.syncedObjects[e];f.id in b||(b[f.id]=f)}var g=[];return Object.keys(b).length>0&&(g=Object.keys(b).map(function(a){return b[a]})),new w(g,this.messenger)},findSyncedObjectsWithAllTags:function(a){var b={},c={};if(!a||a.length<1)return new w([],this.messenger);if(1==a.length)return this.findSyncedObjectsByTag(a[0]);for(var d=this.findSyncedObjectsByTag(a[0]),e=null,f=0;f<d.syncedObjects.length;f++)e=d.syncedObjects[f],c[e.id]=e;for(var g=1;g<a.length;g++)for(d=this.findSyncedObjectsByTag(a[g]),b=c,c={},f=0;f<d.syncedObjects.length;f++)e=d.syncedObjects[f],e.id in b&&(c[e.id]=e);var h=[];return Object.keys(c).length>0&&(h=Object.keys(c).map(function(a){return c[a]})),new w(h,this.messenger)},findAllLayers:function(){for(var a=[],b=0;b<this.allPageData.length;b++){var c=this.allPageData[b];a=a.concat(t.findAllLayers(c.layers,this))}for(var b=0;b<this.allSyncedObjectData.length;b++){var d=this.allSyncedObjectData[b],e=t.findAllLayers(d.layers,this);a=a.concat(e)}return new r(a,this.messenger)},findLayerById:function(a){var b=this.layerMap[a];if(b){var c=this.findPageById(b.pageSlug);return A.buildLayerType(b,this.messenger,this.eventHandler,this,c)}return null},findLayersByTag:function(a){var b=[];if(this.tags[a])for(var c=0;c<this.tags[a].layers.length;c++)b.push(this.findLayerById(this.tags[a].layers[c]));return new r(b,this.messenger)},findComponentById:function(a){var b=this.componentMap[a];if(b){var c=this.findPageById(b.pageSlug);return A.buildLayerType(b,this.messenger,this.eventHandler,this,c)}return null},findAllComponents:function(){for(var a=[],b=0;b<this.allPageData.length;b++){var c=this.allPageData[b];a=a.concat(t.findAllComponents(c.layers,this))}return new s(a,this.messenger)},findComponentsByTag:function(a){var b=[];if(this.tags[a])for(var c=0;c<this.tags[a].components.length;c++)b.push(this.findComponentById(this.tags[a].components[c]));return new s(b,this.messenger)},findComponentsWithAnyTags:function(a){var b={};if(a)for(var c=0;c<a.length;c++)for(var d=this.findComponentsByTag(a[c]),e=0;e<d.components.length;e++){var f=d.components[e];f.id in b||(b[f.id]=f)}var g=[];return Object.keys(b).length>0&&(g=Object.keys(b).map(function(a){return b[a]})),new s(g,this.messenger)},findComponentsWithAllTags:function(a){var b={},c={};if(!a||a.length<1)return new s([],this.messenger);if(1==a.length)return this.findComponentsByTag(a[0]);for(var d=this.findComponentsByTag(a[0]),e=null,f=0;f<d.components.length;f++)e=d.components[f],c[e.id]=e;for(var g=1;g<a.length;g++)for(d=this.findComponentsByTag(a[g]),b=c,c={},f=0;f<d.components.length;f++)e=d.components[f],e.id in b&&(c[e.id]=e);var h=[];return Object.keys(c).length>0&&(h=Object.keys(c).map(function(a){return c[a]})),new s(h,this.messenger)},on:function(a,b){var d=this;a===c.EVENTS.PAGE_CHANGED||a===c.EVENTS.PAGE_CHANGING?this.eventHandler.registerExperienceSpecificHandler(this.experienceId,a,function(a){var c=new x(d.allPageData[d.currentPageNumber-1],d.messenger,d);b(c)}):a===c.EVENTS.SOCIAL_SHARE?this.eventHandler.registerExperienceSpecificHandler(this.experienceId,a,function(a){var e=d.findComponentById(a.componentId),f=c.INTERNAL_SHARE_TYPES[a.shareType];b(e,f)}):a===c.EVENTS.CLICKED||a===c.EVENTS.VIDEO_PLAYED||a===c.EVENTS.ANIMATION_STARTED||a===c.EVENTS.ANIMATION_ENDED?this.eventHandler.registerExperienceSpecificHandler(this.experienceId,a,function(a){var c=d.findComponentById(a.componentId);b(c)}):(a===c.EVENTS.SHOWN||a===c.EVENTS.HIDDEN)&&this.eventHandler.registerExperienceSpecificHandler(this.experienceId,a,function(a){var c=d.findLayerById(a.layerId);b(c)})},setUserConsentForAnalytics:function(a){a?this.messenger.send("sdk.experience.analytics.user.consent.granted"):this.messenger.send("sdk.experience.analytics.user.consent.denied")},getUserConsentForAnalytics:function(a){this.userConsentCallback=a,this.messenger.send("sdk.experience.analytics.get.user.consent")}};var C=function(a){this.experienceWindows=[],this.loadedExperiences={},this.cerosExperienceObjects={},this.experienceDeferreds={},this.finishedLoadingAllExperiences=!1,this.eventHandler=a};C.prototype={initialize:function(){l.log("Must be overridden by child",l.LOG_ERROR)},addExperienceWindow:function(a){this.experienceWindows.push(a)},addLoadedExperience:function(a,b){throw new Error("Should be overridden by child class")},getExperience:function(a){if(!this.experienceDeferreds[a]){if(this.finishedLoadingAllExperiences){var c=new b;return c.reject(new Error('Experience "'+a+'" not found.')),c}this.experienceDeferreds[a]=new b}return this.experienceDeferreds[a]},generateCerosExperience:function(a,b,c){var d=this,e=b||d.loadedExperiences[a];return e||l.log("Experience with ID "+a+" could not be found, but was supposed to have finished loading already.",l.LOG_ERROR),d.cerosExperienceObjects[a]||(d.cerosExperienceObjects[a]=new B(a,e,new n(e.source),this.eventHandler,d,c)),d.cerosExperienceObjects[a]}};var D=function(a){C.call(this,a)};D.prototype=Object.create(C.prototype),D.prototype.constructor=D,D.prototype.initialize=function(){this.experienceWindows=[];for(var a=document.getElementsByClassName("ceros-experience"),b=0;b<a.length;b++)this.addExperienceWindow(a[b].contentWindow)},D.prototype.addLoadedExperience=function(a,c){for(var d=null,e=a.experienceId,f=0;f<this.experienceWindows.length;f++)if(this.experienceWindows[f]==c){a.source=c,this.loadedExperiences[e]=a,d=this.experienceWindows[f];break}if(this.experienceDeferreds[e]||(this.experienceDeferreds[e]=new b),null===d)return l.log('Make sure you add a class="ceros-experience" attribute on the iframe that contains your Ceros experience!',l.LOG_ERROR),void this.experienceDeferreds[e].reject(new Error('Experience "'+e+'" not found.'));l.log('Successfully loaded experience "'+e+'"',l.LOG_DEBUG);var g=this.generateCerosExperience(e);this.experienceDeferreds[e].resolve(g);var h=0;for(var i in this.loadedExperiences)this.loadedExperiences.hasOwnProperty(i)&&h++;if(h===this.experienceWindows.length){this.finishedLoadingAllExperiences=!0;for(var j in this.experienceDeferreds)this.experienceDeferreds.hasOwnProperty(j)&&this.experienceDeferreds[j]._state!==this.experienceDeferreds[j].STATE.RESOLVED&&this.experienceDeferreds[j].reject(new Error('Experience "'+e+'" not found.'))}};var CerosSDK=function(){var a=new o(!0),b=new D(a);q.call(this,a,b)};return CerosSDK.prototype=Object.create(q.prototype),CerosSDK.prototype.constructor=CerosSDK,CerosSDK.prototype.insertScrollProxy=function(a){var b=document.createElement("script");b.setAttribute("src",a+"//"+this.domain+"/scroll-proxy.js"),document.head.appendChild(b)},CerosSDK.prototype.insertExperience=function(a,c,d,e){var f=window.location.protocol;"file:"===f&&(f="http:"),this.insertScrollProxy(f);var g=this,h=new b,i=document.getElementById(d);if(i){var j=document.createElement("iframe"),k="";isNaN(e)||parseInt(Number(e))!=e||isNaN(parseInt(e,10))?e=null:k="?heightOverride="+e,j.src=f+"//"+this.domain+"/"+a+"/"+c+k;var l;l=this.isPreviewDomain(this.domain)?g.generateFrameStyleString():g.generateFrameStyleString("-50000px","-50000px"),j.setAttribute("style",l),j.setAttribute("class","ceros-experience"),j.setAttribute("allowfullscreen",""),this.eventHandler.registerGlobalHandler("ready",function(a,b){if(a.experienceAlias===c){var f=a.documentVersion.viewportWidth/a.documentVersion.viewportHeight;e&&(f=a.documentVersion.viewportWidth/e),i.setAttribute("style",g.generateContainerStyleString(f)),a.source=b;var k=g.experienceTracker.generateCerosExperience(a.experienceId,a,d),l=g.generateFrameStyleString();j.setAttribute("style",l),g.experienceTracker.addExperienceWindow(j.contentWindow),window.sendViewportPositionEvent&&window.sendViewportPositionEvent(j),h.resolve(k)}}),this.eventHandler.needToInvalidateCerosIframeCache=!0,i.appendChild(j)}return h},CerosSDK.prototype.isPreviewDomain=function(a){var b=!1;if(a){var c=a.toLowerCase();b=-1!==c.indexOf("preview.ceros.com")||-1!==c.indexOf("preview.cerosdev.com")}return b},CerosSDK.prototype.generateContainerStyleString=function(a){var b=0;a&&(b=(100/a).toFixed(2));var c={position:"relative",width:"auto",padding:"0 0 "+b+"%",height:"0",top:"0",left:"0",bottom:"0",right:"0",margin:"0",border:"0 none"},d="";for(var e in c)d=d.concat(e+":"+c[e]+";");return d},CerosSDK.prototype.generateFrameStyleString=function(a,b){var c={position:"absolute",width:"100%",height:"100%",display:"inline",top:a||"0",left:b||"0",bottom:"0",right:"0",margin:"0",padding:"0",border:"0 none"},d="";for(var e in c)d=d.concat(e+":"+c[e]+";");return d},CerosSDK.prototype.setDomain=function(a){this.domain=a},CerosSDK.prototype.getContext=function(a){return a&&a.messenger?new p(a.messenger,this.eventHandler):null},CerosSDK.prototype.getContextValue=function(a,b,c){var d=this.getContext(a);d.getEmbeddedValue(b,c)},a.CerosSDK=new CerosSDK,a.CerosSDK});